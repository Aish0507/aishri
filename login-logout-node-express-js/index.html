<!DOCTYPE html>
<html lang="en">

<head>

    <!-- Meta Tag -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- SEO -->
    <meta name="description" content="150 words">
    <meta name="author" content="uipasta">
    <meta name="url" content="http://www.yourdomainname.com">
    <meta name="copyright" content="company name">
    <meta name="robots" content="index,follow">
    <title>Aishvarya - Personal Blog</title>
    <!-- Favicon -->
    <link rel="shortcut icon" href="../images/favicon/favicon-new.ico">
    <link rel="apple-touch-icon" sizes="144x144" type="image/x-icon" href="../images/favicon/apple-touch-icon.png">

    <!-- All CSS Plugins -->
    <link rel="stylesheet" type="text/css" href="../css/plugin.css">

    <!-- Main CSS Stylesheet -->
    <link rel="stylesheet" type="text/css" href="../css/style.css">

    <!-- Google Web Fonts  -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:400,300,500,600,700">

    <!-- Syntax Highlighter  -->
    <link rel="stylesheet" type="text/css" href="../css/syntax/shCore.css">
    <link rel="stylesheet" type="text/css" href="../css/syntax/shThemeDefault.css">


    <!-- HTML5 shiv and Respond.js support IE8 or Older for HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<!-- Preloader Start -->
<div class="preloader">
    <div class="rounder"></div>
</div>
<!-- Preloader End -->


<div id="main">
    <div class="container">
        <div class="row">
            <!-- About Me (Left Sidebar) Start -->
            <div class="col-md-3">
                <div class="about-fixed">

                    <div class="my-pic">
                        <img src="../images/pic/aish.jpg" alt="">
                        <a href="javascript:void(0)" class="collapsed" data-target="#menu" data-toggle="collapse"><i
                                class="icon-menu menu"></i></a>
                        <div id="menu" class="collapse">
                            <ul class="menu-link">
                                <li><a href="../about.html">About</a></li>
                                <!--<li><a href="../work.html">Work</a></li>-->
                                <li><a href="../contact.html">Contact</a></li>
                            </ul>
                        </div>
                    </div>


                    <div class="my-detail">

                        <div class="white-spacing">
                            <h1> Aishvarya Shrivastava</h1>
                            <span>Full Stack Developer</span>
                        </div>

                        <ul class="social-icon">
                            <li><a href="#" target="_blank" class="facebook"><i class="fa fa-facebook"></i></a></li>
                            <li><a href="#" target="_blank" class="twitter"><i class="fa fa-twitter"></i></a></li>
                            <li><a href="#" target="_blank" class="linkedin"><i class="fa fa-linkedin"></i></a></li>
                            <li><a href="#" target="_blank" class="github"><i class="fa fa-github"></i></a></li>
                        </ul>

                    </div>
                </div>
            </div>
            <!-- About Me (Left Sidebar) End -->


            <!-- Blog Post (Right Sidebar) Start -->
            <div class="col-md-9">
                <div class="col-md-12 page-body">
                    <div class="row">
                        <div class="sub-title">
                            <a href="../index.html" title="Go to Home Page"><h2>Back Home</h2></a>
                            <!--<a href="#comment" class="smoth-scroll"><i class="icon-bubbles"></i></a>-->
                        </div>

                        <div class="col-md-12 content-page">
                            <div class="col-md-12 blog-post">
                                <!-- Post Headline Start -->
                                <div class="post-title">
                                    <h1>
                                        Login logout with REST-ful API using Nodejs And Express 4 JS
                                    </h1>
                                </div>
                                <!-- Post Headline End -->
                                <!-- Post Detail Start -->
                                <div class="post-info">
                                    <span>August 18, 2018 / by
                                        <a href="#" target="_blank"> Aishvarya Shrivastava</a>
                                    </span>
                                </div>
                                <!-- Post Detail End -->
                                <h4>So first, let’s start with building app structure.</h4>
                                <h3>Build Up The Node App Structure</h3>
                                <p>Following the node express folder architecture to build the RESTful API.</p>
                                <!-- Post Image Start -->
                                <div class="post-image margin-top-40 margin-bottom-40">

                                    <pre class="brush: js">
                                    |___package.json
                                    |
                                    |___app.js
                                    |
                                    |___controller
                                    |        |__index.js
                                    |        |__users.js
                                    |
                                    |___models
                                    |        |__users
                                    |        |      |__login.js
                                    |        |      |__logout.js
                                    |        |__db.js

                                    </pre>
                                </div>
                                <!-- Post Image End -->
                                <h4>Node Express 4</h4>
                                <p>
                                    For the login and logout api, We will be using the <strong>POST</strong> method of
                                    the RESTful Api.
                                    As it posts request to the server. Login api will fetch the data from database.
                                </p>
                                <p>
                                <h3>
                                    Install Dependencies
                                </h3>
                                </p>
                                <!-- Post Coding (SyntaxHighlighter) Start -->
                                <div class="margin-top-40 margin-bottom-40">
                                    <p>
                                        So let’s start with installing the dependencies.
                                        We will going to use following node modules for handling session :
                                    <ul>
                                        <li>Node Express 4</li>
                                        <li>Body parser</li>
                                        <li>
                                            MySql
                                        </li>
                                    </ul>
                                    </p>
                                    <pre class="brush: js">
                                   /* Package.json */
                                       {
                                      "name": "expapp",
                                      "version": "1.0.0",
                                      "description": "",
                                      "main": "app.js",
                                      "scripts": {
                                        "test": "echo \"Error: no test specified\" && exit 1"
                                      },
                                    "dependencies": {
                                        "async": "^1.5.2",
                                        "body-parser": "^1.14.1",
                                        "express": "^4.13.3",
                                        "express-session": "^1.12.1",
                                        "http-proxy": "^1.12.0",
                                        "mysql": "^2.9.0",
                                        "node-mysql": "^0.4.2",
                                      }
                                    }

                                  </pre>
                                    <pre class="brush: js">
                                     /* CMD */
                                    $ npm install
                                    </pre>
                                </div>
                                <div class="margin-top-40 margin-bottom-40">
                                    <p>
                                    <h3>Initialization And Require</h3>
                                    First will include require node modules.
                                    Do database connection of MySql using NodeJS express 4.
                                    </p>
                                    <pre class="brush: js">
                                   /* app.js */
                                    var express = require('express');
                                    var app = express();
                                    var bodyParser = require('body-parser');
                                    var session = require('express-session');
                                    var db = require('./models/db.js');

                                    app.use(bodyParser.json());
                                    app.use(bodyParser.urlencoded({
                                      extended: true
                                    }));// Body parser use JSON data

                                    if(GLOBAL.SQLpool === undefined){
                                        GLOBAL.SQLpool = db.createPool(); //create a global sql pool connection
                                    }
                                    app.use(require('./controllers'));
                                    app.listen('3000', function(){
                                        console.log("Connected on port 3000.");
                                    });
                                  </pre>
                                </div>
                                <div class="margin-top-40 margin-bottom-40">
                                    <p>
                                    <h3>Controller Directory</h3>
                                    The controller defines your app routes and their logic. Controllers will handle web
                                    requests, serve your templates to the user and interact with your models to process
                                    and retrieve data. It’s the glue which connects and controls your web application.
                                    Controller index file control all the files in the current directory and export to
                                    the models.
                                    </p>
                                    <pre class="brush: js">
                                   /* /controller/index.js */
                                    var express = require('express')
                                      , router = express.Router();
                                    router.use('/api/users', require('./users'));
                                    module.exports = router;
                                  </pre>
                                </div>
                                <div class="margin-top-40 margin-bottom-40">
                                    <p>
                                    <h3>The Login Api</h3>
                                    First we will build the login api for the registered user.
                                    lets start with the <strong>/controller/users.js</strong>
                                    </p>
                                    <pre class="brush: js">
                                   /* /controller/users.js */

                                    var express = require('express'),
                                        router = express.Router(),
                                        signup = require('../models/users/login.js');

                                    router.post('/login', function(req, res) {
                                      login.loginUser(req, res, function(err, data) {
                                        if (err) {
                                          res.json({ 'error': true, 'message': 'Error logged in' });
                                        } else {
                                          res.json({ 'success': true, 'data': data });
                                        }
                                      });
                                    });

                                    module.exports = router;
                                  </pre>
                                    <b>
                                        Note - Where the /controller/users.js control the the session of login.
                                    </b>
                                </div>
                                <div class="margin-top-40 margin-bottom-40">
                                    <p>
                                    <h3>Login Models Directory</h3>
                                    Models are the files where you interact with your database. They contain all the
                                    methods and functions which will handle your data. This will create a login session
                                    for the users.
                                    </p>
                                    <pre class="brush: js">
                                   /* /models/users/login.js */
                                    var mysql =	require("../db.js"),
                                        mysqlPool = mysql.createPool();
                                    /**
                                     * Defines login operations.
                                     * @class
                                     */
                                    var login = function(){};

                                    /**
                                     * Authenticate user.
                                     * @Function
                                     * @param callback
                                     */
                                    login.prototype.loginUser = function(req, res, callback){
                                        var nowDate = new Date().toISOString().slice(0, 19).replace('T', ' '),
                                            params = [req.body.email, req.body.password,1],
                                            detailParams = [],
                                            updateParams = [],
                                            loginUserQuery = 'SELECT * FROM users WHERE email = ? AND password = ?',
                                            getDetailQuery = 'SELECT id, email, gender, lastLogin, name, role, state FROM users WHERE id = ?',
                                            updateLastloginTime = 'UPDATE users SET lastLogin = ? WHERE id = ?'; //updates the date of lastlogin field
                                        mysqlPool.getConnection(function(err, connection){
                                            connection.query(loginUserQuery, params, function(err, rows, fields) {
                                               if(rows.length <= 0){
                                                    connection.release();
                                                    callback(true, null);
                                                }else{
                                                    updateParams = [nowDate, rows[0].id];
                                                    detailParams = [rows[0].id];
                                                    req.session.user = rows[0];
                                                    connection.query(updateLastloginTime, updateParams, function(err, rows, fields) {
                                                        connection.query(getDetailQuery, detailParams, function(err, rows, fields) {
                                                            connection.release();
                                                            callback(null, rows[0]);
                                                        });
                                                    });
                                                }
                                            });
                                        });
                                    }

                                    module.exports = new login();

                                  </pre>
                                </div>
                                <div class="margin-top-40 margin-bottom-40">
                                    <h3>Demo On Postman API App For Login Api</h3>
                                    <div class="post-image margin-top-40 margin-bottom-40">
                                        <img src="../images/blog/login-logout-api-node-express/Login-postman-demo.jpg"
                                             alt="">
                                        <!--<p>Image source from <a href="#" target="_blank">Link</a></p>-->
                                    </div>
                                </div>
                                <div class="margin-top-40 margin-bottom-40">
                                    <h3>Logout Api</h3>
                                   <p>The logout API will close the logged in session.
                                       The request made by logout API will clear the saved data in server
                                       and put back to its origin state.
                                       So start with controller Again!</p>
                                </div>
                                <div class="margin-top-40 margin-bottom-40">
                                    <p>
                                    <h3>Controller Directory</h3>
                                    </p>
                                    <pre class="brush: js">
                                   /* /controller/users.js */

                                    var express = require('express'),
                                        router = express.Router(),
                                        signup = require('../models/users/logout.js');

                                    router.post('/logout', function(req, res) {
                                      logout.logoutUser(req, res, function(err, data) {
                                        if (err) {
                                          res.json({ 'error': data.error, 'message': data.message });
                                        } else {
                                          res.json({ 'success': data.success, 'message': data.message });
                                        }
                                      });
                                    });
                                    module.exports = router;
                                  </pre>
                                </div>
                                <div class="margin-top-40 margin-bottom-40">
                                    <p>
                                    <h3>Models Directory</h3>
                                    And now the <strong>/models/users/logout.js</strong> will clear the logged in session
                                    from the server and bring back to null state.
                                    </p>
                                    <pre class="brush: js">
                                   /* /models/users/logout.js */
                                    var mysql =	require("../db.js"),
                                        mysqlPool = mysql.createPool();
                                    /**
                                     * Defines logout operations.
                                     * @class
                                     */
                                    var logout = function(){};

                                    /**
                                     * logging out user.
                                     * @Function
                                     * @param req
                                     * @param res
                                     * @param callback
                                     */
                                    logout.prototype.logoutUser = function(req, res, callback){
                                        var sess = req.session.user;
                                        if(sess){
                                            req.session.user = null;
                                            return callback(null, {'success': true, "message": "user logout successfully"});
                                        }
                                        callback(null, {'success': true, "message": "user logout successfully"});
                                    }
                                    module.exports = new logout();
                                  </pre>
                                </div>
                                <div class="margin-top-40 margin-bottom-40">
                                    <h3>Demo On Postman API App For Logout Api</h3>
                                    <div class="post-image margin-top-40 margin-bottom-40">
                                        <img src="../images/blog/login-logout-api-node-express/Logout-postman-demo.jpg"
                                             alt="">
                                        <!--<p>Image source from <a href="#" target="_blank">Link</a></p>-->
                                    </div>
                                </div>
                                <!-- Post List Style End -->
                                <!-- Post Author Bio Box Start -->
                                <div class="about-author margin-top-70 margin-bottom-50">

                                    <div class="picture">
                                        <img src="../images/pic/banner-bg.jpg" class="img-responsive" alt="">
                                    </div>

                                    <div class="">
                                        <h3>Article By <a href="#" target="_blank" data-toggle="tooltip"
                                                          data-placement="top" title="Visit Aishvarya Website">Aishvarya
                                            Shrivastava</a></h3>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Footer Start -->
                <div class="col-md-12 page-body margin-top-50 footer">
                    <footer>
                        <ul class="menu-link">
                            <li><a href="../index.html">Home</a></li>
                            <li><a href="../about.html">About</a></li>
                            <!--<li><a href="../work.html">Work</a></li>-->
                            <li><a href="../contact.html">Contact</a></li>
                        </ul>
                        <!-- UiPasta Credit Start -->
                        <div class="uipasta-credit">Design By <a href="http://aishri.com" target="_blank">Aishvarya
                            Shrivastava</a></div>
                        <!-- UiPasta Credit End -->
                    </footer>
                </div>
                <!-- Footer End -->
            </div>
            <!-- Blog Post (Right Sidebar) End -->
        </div>
    </div>
</div>


<!-- Endpage Box (Popup When Scroll Down) Start -->
<div id="scroll-down-popup" class="endpage-box">
    <h4>Read Also</h4>
    <a href="../node-video-stream/index.html">How to processed video stream with Node/Express API and HTML 5...</a>
</div>
<!-- Endpage Box (Popup When Scroll Down) End -->


<!-- Back to Top Start -->
<a href="#" class="scroll-to-top"><i class="fa fa-long-arrow-up"></i></a>
<!-- Back to Top End -->


<!-- All Javascript Plugins  -->
<script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript" src="../js/plugin.js"></script>

<!-- Main Javascript File  -->
<script type="text/javascript" src="../js/scripts.js"></script>

<!-- Syntax Highlighter Javascript File  -->
<script type="text/javascript" src="../js/syntax/shCore.js"></script>
<script type="text/javascript" src="../js/syntax/shBrushCss.js"></script>
<script type="text/javascript" src="../js/syntax/shBrushJScript.js"></script>
<script type="text/javascript" src="../js/syntax/shBrushPerl.js"></script>
<script type="text/javascript" src="../js/syntax/shBrushPhp.js"></script>
<script type="text/javascript" src="../js/syntax/shBrushPlain.js"></script>
<script type="text/javascript" src="../js/syntax/shBrushPython.js"></script>
<script type="text/javascript" src="../js/syntax/shBrushRuby.js"></script>
<script type="text/javascript" src="../js/syntax/shBrushSql.js"></script>
<script type="text/javascript" src="../js/syntax/shBrushVb.js"></script>
<script type="text/javascript" src="../js/syntax/shBrushXml.js"></script>

<!-- Syntax Highlighter Call Function -->
<script type="text/javascript">
    SyntaxHighlighter.config.clipboardSwf = '../js/syntax/clipboard.swf';
    SyntaxHighlighter.all();
</script>


</body>
</html>
